# Gemini MindDiary 작업 기록

## 2025년 11월 9일 (일)

### 1. 프로젝트 목표 설정
*   **프로젝트명:** MindDiary
*   **목표:** 사용자의 일기 텍스트를 분석하여 감정과 주제 단어를 추출하고, 단어 간 연관도를 네트워크 그래프로 시각화하는 CLI 툴 (초기 계획)
*   **제약사항:** LLM 사용하지 않음, `konlpy`, `networkx`, `matplotlib` 라이브러리 활용
*   **개발 목표:** 하루 만에 PoC(Proof of Concept) 구현

### 2. 개발 방향 변경 (CLI -> Web Application)
*   사용자가 개발자가 아닌 일반 사용자임을 고려하여, CLI 툴 대신 **웹 애플리케이션** 형태로 개발 방향 변경 결정.
*   **백엔드:** FastAPI 활용
*   **프론트엔드:** 간단한 HTML/CSS/JS (Jinja2 템플릿 사용)

### 3. 프로젝트 구조 및 파일 생성
FastAPI 기반 웹 애플리케이션 PoC를 위한 간소화된 프로젝트 구조 제안 및 생성 완료.

```
mind-diary/
├── static/            # 생성된 그래프 이미지 등 정적 파일 보관
│   └── images/
├── templates/         # 웹페이지 HTML 파일 보관
│   └── index.html
├── main.py            # FastAPI 서버와 모든 분석/시각화 로직
└── requirements.txt   # 라이브러리 의존성 목록
```

*   `static/images` 디렉토리 생성
*   `templates` 디렉토리 생성
*   `requirements.txt` 파일 생성 및 초기 의존성 추가 (`fastapi`, `uvicorn[standard]`, `konlpy`, `networkx`, `matplotlib`, `jinja2`)
*   `templates/index.html` 파일 생성 및 기본 HTML 구조 추가
*   `main.py` 파일 생성 및 FastAPI 기본 서버 코드, 정적 파일 및 템플릿 설정, 임시 그래프 생성 로직 포함

### 4. 현재 진행 상황
*   프로젝트 구조 및 파일 생성 완료.
*   사용자가 가상 환경 활성화 후 `requirements.txt` 기반 라이브러리 설치 진행 중.

---
## 추가 개발 기록

### 5. 환경 설정 문제 해결 (`JAVA_HOME`)
*   `konlpy` 라이브러리 실행 시 필요한 Java 경로(`JAVA_HOME`)를 찾지 못하는 오류 발생.
*   사용자의 시스템에 Java가 설치된 경로(`C:\Program Files\Java\jdk-17.0.1`)를 확인.
*   `setx` 명령어를 사용하여 `JAVA_HOME` 환경 변수를 영구적으로 설정하고, 시스템 `Path`에 Java `bin` 디렉토리를 추가하여 문제 해결.
*   환경 변수 적용을 위해 터미널(IDE) 재시작이 필요함을 안내.

### 6. 1차 기능 개선 (UI 및 그래프 시각화)
*   **사용자 피드백:** "그래프가 너무 단순하고 UI가 예쁘지 않다."
*   **UI 개선:**
    *   `templates/index.html` 파일 수정.
    *   Noto Sans KR 웹 폰트 적용 및 전체적인 레이아웃, 색상, 컴포넌트(입력창, 버튼) 스타일을 현대적으로 변경.
*   **그래프 개선:**
    *   `main.py`의 `analyze_text_and_create_graph` 함수 수정.
    *   단어의 중요도(연결성)에 따라 노드 크기와 색상을 다르게 표현.
    *   단어 간 연관성에 따라 연결선 두께와 투명도를 조절하여 핵심 관계를 강조.

### 7. 2차 기획 변경 (핵심 기능 재정의)
*   **사용자 피드백:** "개선된 그래프도 결국 무엇을 보여주고 싶은지 모르겠다. 다른 앱과 차별점이 없다."
*   **브레인스토밍:**
    *   1안: 감정/키워드를 요약하는 "마인드 리포트" 제안 → 차별점 부족으로 기각.
    *   2안: 생각의 흐름을 따라가는 **"생각의 지도 (Mind Map)"** 컨셉 제안 → 채택.
*   **새로운 목표:** 사용자의 일기 내용에 따라 생각의 흐름(서사)을 시각적으로 보여주는 독창적이고 심미적인 기능 구현.

### 8. "생각의 지도" 기능 구현
*   **`templates/index.html` 수정:** 새로운 기능에 맞춰 제목과 안내 문구 변경.
*   **`main.py` 핵심 로직 변경:**
    *   기존 `analyze_text_and_create_graph` 함수를 `create_thought_map` 함수로 대체.
    *   문장 순서와 단어의 연결 관계를 추적하여 **방향성 있는 그래프(DiGraph)**를 생성하는 로직 구현.
    *   시각화 라이브러리(`matplotlib`, `networkx`)의 파라미터를 조정하여 심미성 극대화:
        *   생각의 시작점(Start Node)을 다른 색상으로 강조.
        *   생각의 흐름을 명확히 보여주는 **화살표** 스타일 적용.
        *   전체적인 레이아웃, 색상, 폰트를 세련되게 개선.
    *   분석할 텍스트가 부족할 경우, 사용자에게 적절한 안내 메시지를 보여주는 예외 처리 로직 추가.

### 9. 3차 기획 변경: "인터랙티브 마인드 갤럭시" 구현

*   **사용자 피드백:** "그래프가 너무 보기 어렵고, 옵시디언처럼 인터랙티브하고 은하계 같은 느낌을 원한다."
*   **아키텍처 전환:** 서버에서 정적 이미지 생성 방식에서, 브라우저에서 직접 그래프를 그리는 동적 방식으로 전환 결정.
    *   **백엔드 (`main.py`) 역할 변경:**
        *   `generate_graph_data` 함수 구현: `konlpy`와 `networkx`를 사용하여 일기 텍스트를 분석, 노드(단어)와 링크(연결) 정보를 포함하는 JSON 데이터로 변환하여 반환.
        *   `/analyze` 엔드포인트가 `JSONResponse`를 반환하도록 변경.
    *   **프론트엔드 (`index.html`) 역할 변경:**
        *   `force-graph` 라이브러리(CDN)를 사용하여 JSON 데이터를 받아 인터랙티브 그래프 렌더링.
        *   전체 페이지를 단일 페이지 애플리케이션(SPA) 형태로 재구성.

*   **주요 기능 및 시각적 요소 구현:**
    *   **노드 드래그 및 물리 엔진:** `force-graph`의 물리 엔진을 활용하여 노드들이 서로 밀고 당기며 움직이는 동적인 레이아웃 구현.
    *   **감정 기반 노드 색상:**
        *   백엔드에서 단어의 긍정/부정/중립 감정을 분석하여 노드 데이터에 추가.
        *   프론트엔드에서 긍정(파랑), 부정(빨강), 중립(무작위 파스텔톤)에 따라 노드 색상을 동적으로 변경.
    *   **노드 크기 조절:** 단어 빈도와 연결성(degree)에 따라 노드 크기를 동적으로 조절하여 핵심 단어 강조.
    *   **"감정의 흐름" 입자 효과:** 연결선 위를 소스 노드의 감정 색상을 가진 입자가 흘러가도록 구현하여 생각의 흐름과 감정의 전이를 시각화.
    *   **다양한 표시 모드:** 노드만, 단어만, 모두 표시하는 옵션을 사이드바에 추가하여 사용자가 선택 가능하도록 구현.
    *   **입력창 크기 조절:** 텍스트 입력창의 기본 크기를 확대하고 수직 크기 조절 가능하도록 변경.

*   **버그 수정 및 시각적 튜닝:**
    *   **JSON만 보이는 문제 해결:** JavaScript 코드를 `DOMContentLoaded` 이벤트 리스너 내부에 배치하여 스크립트 실행 시점 조정.
    *   **노드 클릭 안 되는 문제 해결:** `nodePointerAreaPaint` 함수를 수정하여 클릭 감지 영역을 정확히 지정.
    *   **물리 엔진 및 입자 효과 튜닝:**
        *   초기에는 너무 강한 척력으로 그래프가 뻣뻣하고 입자 효과가 사라지는 문제 발생.
        *   `d3AlphaDecay`, `d3VelocityDecay`, `charge` 힘을 섬세하게 조정하여 부드럽고 개별적인 노드 움직임과 명확한 입자 흐름 구현.
        *   `linkCurvature` 및 `link` 힘의 `strength`, `distance` 조정을 통해 그래프의 선형성 완화 및 노드 간 거리 균형 조절.
        *   입자 속도 및 크기 조정으로 흐름 효과 최적화.
        *   노드 간 장력(link strength) 및 거리(link distance) 재조정을 통해 노드 간의 적절한 거리 유지 및 조작 용이성 확보.
        *   `charge` 힘과 `linkCurvature` 재조정을 통해 그래프의 전체적인 형태가 직선으로 뻗어나가지 않고 더 유기적인 모양을 갖도록 개선.

---

### 10. 배포 방법 안내

*   **로컬 네트워크 배포:** `uvicorn main:app --host 0.0.0.0 --port 8000` 명령어를 통해 동일 네트워크 내 다른 기기에서 접속 가능.
*   **클라우드 배포 (Paas):** Heroku, Render, PythonAnywhere 등 PaaS 서비스를 이용하면 웹에 공개적으로 배포 가능. (추가 설정 필요)